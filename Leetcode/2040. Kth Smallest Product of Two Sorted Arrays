Example 1:

Input: nums1 = [2,5], nums2 = [3,4], k = 2
Output: 8
Explanation: The 2 smallest products are:
- nums1[0] * nums2[0] = 2 * 3 = 6
- nums1[0] * nums2[1] = 2 * 4 = 8
The 2nd smallest product is 8.
----------------------------------------

class Solution {
    public long kthSmallestProduct(int[] nums1, int[] nums2, long k) {
         long left = -10000000000L, right = 10000000000L;
        while (left < right) {
            long mid = left + (right - left) / 2;
            if (count(nums1, nums2, mid) >= k)
                right = mid;
            else
                left = mid + 1;
        }
        return left;
    }

    private long count(int[] a, int[] b, long x) {
        long res = 0;
        int n = b.length;

        for (int v : a) {
            if (v == 0) {
                if (x >= 0) res += n;
            } else if (v > 0) {
                int l = 0, r = n - 1;
                while (l <= r) {
                    int mid = (l + r) / 2;
                    if ((long) v * b[mid] <= x) l = mid + 1;
                    else r = mid - 1;
                }
                res += l;
            } else { // v < 0
                int l = 0, r = n - 1;
                while (l <= r) {
                    int mid = (l + r) / 2;
                    if ((long) v * b[mid] <= x) r = mid - 1;
                    else l = mid + 1;
                }
                res += n - l;
            }
        }
        return res;
    }
}
